<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cafe Curator</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚òïÔ∏è</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Savate:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>‚òïÔ∏è Cafe Curator üçµ</h1>
    <p>Find and save the best cafes near you.</p>

    <div>
        <button onclick="getLocation()">Find Cafes Near Me</button>
        <button onclick="showSaved()">Show Saved Cafes</button>
    </div>

    <div class="cards"></div>

    <script>
      const apiKey = ""; // Replace with your Google Places API key
      const useProxy = true; // Set to true if you want to use a CORS proxy
      const proxyUrl = "https://cors-anywhere.herokuapp.com/"; // CORS proxy

      function getLocation() {
        const cache = JSON.parse(localStorage.getItem('cachedLocation') || '{}'); 
        const now = Date.now();

        if (cache.timestamp && now - cache.timestamp < 10 * 60 * 1000) {
          useLocation(cache.lat, cache.lng);
        } else {
          navigator.geolocation.getCurrentPosition(pos => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            localStorage.setItem('cachedLocation', JSON.stringify({ lat, lng, timestamp: now }));
            useLocation(lat, lng);
          }, () => alert("Location access denied or unavaliable"));
        } 
      }

      async function useLocation(lat, lng) {
        const endpoint = `https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${lat},${lng}&radius=1500&type=cafe&key=${apiKey}`;
        const url = useProxy ? proxy + endpoint : endpoint;

        try {
          const response = await fetch(url);
          const data = await response.json();

          if (data.results) {
            displayCards(data.results);
          } else {
            alert('No cafes found.')
          }
        } catch (e) {
          console.error('Error fetching Places API:', e);
          alert('Error fetching cafes.');
        }
      }

      function displayCards(cafes) {
        const container = document.querySelector('.cards');
        container.innerHTML = '';
        
        cafes.forEach((cafe, i) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'swipe-wrapper';
          wrapper.style.zIndex = cafes.length - i;

          var newCards = document.querySelectorAll('.location-card:not(.removed)');
          var allCards = document.querySelectorAll('.location-card');
        })
      }

      const card = document.createElement('div');
      card.className = 'location-card';

      const imgUrl = cafe.photos?.[0]?.photo_reference
        ? `https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference=${cafe.photos[0].photo_reference}&key=${apiKey}`
        : 'https://via.placeholder.com/250x150?text=No+Image';

      const cafeData = {
        name: cafe.name || 'Unknown Cafe',
        place_id: cafe.place_id || 'Address not available',
        rating: cafe.rating || 'N/A',
        photo: imgUrl || 'No photos found'
      };

      card.innerHTML = `
      <img src="${imgUrl}" alt="${cafe.name}" />
      <h3>${cafe.name}</h3>
      <p>‚≠êÔ∏è Rating: ${cafe.rating || 'N/A'}</p>
      <p><small>Swipe right to save üíñ</small></p>
      `;

    wrapper.appendChild(card);
    container.appendChild(wrapper);
    </script>

</body>
</html>